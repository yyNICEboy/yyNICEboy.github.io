
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>实训报告格式自检</title>
  <!-- 引入外部库 -->
  <!-- Animate.css 用于动画效果 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- SweetAlert2 用于弹出提示 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Confetti.js 用于庆祝动画 -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .checkbox { display: flex; align-items: center; }
    .checkbox input { margin-right: 10px; }
    .completed { text-decoration: line-through; color: gray; }
    #badges span { 
      margin-right: 10px; 
      background-color: #e0e0e0; 
      padding: 5px 10px; 
      border-radius: 5px; 
      display: inline-block; 
      transition: transform 0.3s;
    }
    #badges span.unlocked {
      transform: scale(1.2);
      animation: tada 1s;
    }
    #progress-bar {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin: 20px 0;
    }
    #progress {
      width: 0%;
      height: 20px;
      background-color: #76c7c0;
      border-radius: 5px;
      text-align: center;
      color: white;
      line-height: 20px;
      transition: width 0.3s ease;
    }
    /* Animate.css keyframes for tada animation */
    @keyframes tada {
      from { transform: scale3d(1, 1, 1); }
      10%, 20% { transform: scale3d(0.9, 1.1, 1); }
      30%, 50%, 70%, 90% { transform: scale3d(1.1, 0.9, 1); }
      40%, 60%, 80% { transform: scale3d(0.95, 1.05, 1); }
      to { transform: scale3d(1, 1, 1); }
    }
    /* 额外美化 */
    h1, h2, h3 {
      color: #333;
    }
    .section-divider {
      margin: 40px 0;
      border-top: 2px dashed #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    /* Badge Icons */
    .badge-icon {
      margin-right: 5px;
    }
    /* 进度条颜色变化 */
    #progress.low { background-color: #ff4d4d; }
    #progress.medium { background-color: #ffdb4d; }
    #progress.high { background-color: #4dff4d; }
    /* 等级显示 */
    #level-display {
      margin-top: 20px;
      font-size: 1.2em;
      color: #333;
    }
    /* 提交按钮样式 */
    #submit-button {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 1em;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #submit-button:hover {
      background-color: #45a049;
    }
    /* 模态窗口样式 */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto; /* 5% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%; /* Could be more or less, depending on screen size */
      border-radius: 10px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: none;
    }
  </style>
</head>
<body>
  <h1>📝实训报告格式自检</h1>
<h2>任务总览</h2>
<ul>
<li><strong>总积分</strong>：<span id="total-points">0</span></li>
<li><strong>已解锁徽章</strong>：<span id="badges">无</span></li>
</ul>
<h2>🛠️整体检查</h2>
<ul>
<li id="task-word-count"><input type="checkbox" id="cbx_0"><label for="cbx_0"></label><strong>字数不少于 1W5</strong>🧐，代码需要用截图来表示📸 <!-- points:10 --></li>
<li id="task-last-page"><input type="checkbox" id="cbx_1"><label for="cbx_1"></label><strong>最后页码 ≥ 50</strong> 📄 <!-- points:10 --></li>
<li><input type="checkbox" id="cbx_2"><label for="cbx_2">页眉页码是否正确设置（页眉 1.6，页码 2.1）✔️，且整体是否完成以下要求：</label>
<ul>
<li id="task-header-odd-even">奇偶页不同页眉 <!-- points:5 --></li>
<li id="task-roman-numbers">前置部分为罗马数字（i, ii, iii…） <!-- points:5 --></li>
<li id="task-arabic-numbers">正文部分为阿拉伯数字（1, 2, 3…）🔢 <!-- points:5 --></li>
</ul>
</li>
<li id="task-page-setup"><input type="checkbox" id="cbx_3"><label for="cbx_3">页面设置是否正确🖥️ </label><!-- points:10 --></li>
<li id="task-level-1-title"><input type="checkbox" id="cbx_4"><label for="cbx_4">一级标题是否正确设置 </label><!-- points:10 -->
<ul>
<li><strong>前后均空一行</strong></li>
<li>必须出现在一页的最上方 👌</li>
</ul>
</li>
<li id="task-level-2-title"><input type="checkbox" id="cbx_5"><label for="cbx_5">二级标题，左对齐： </label><!-- points:10 -->
<ul>
<li><strong>前有一空行</strong>，后面没有空行 📝</li>
</ul>
</li>
<li id="task-level-3-title"><input type="checkbox" id="cbx_6"><label for="cbx_6">三级标题： </label><!-- points:10 -->
<ul>
<li><strong>缩进两个字符</strong>，<strong>前后均无空行</strong> ➡️</li>
</ul>
</li>
<li id="task-body-format"><input type="checkbox" id="cbx_7"><label for="cbx_7">正文格式是否符合以下要求： </label><!-- points:15 -->
<ul>
<li>行距、字体大小正确 ✔️（如字体为小四号字；间距设置为标准字间距，行间距设置为固定值20磅）</li>
<li>中英文字体类型符合要求（如中文字体为宋体，英文为：Times New Roman） 📐</li>
</ul>
</li>
<li id="task-title-format"><input type="checkbox" id="cbx_8"><label for="cbx_8">标题格式是否符合要求（</label><strong>注意都不需要加粗</strong>） 🔍 <!-- points:10 --></li>
<li id="task-english-abbr"><input type="checkbox" id="cbx_9"><label for="cbx_9">第一次出现英文缩写是否有全称： </label><!-- points:10 -->
<ul>
<li><strong>英文全称 + 中文解释</strong> 🌏</li>
</ul>
</li>
</ul>
<hr>
<h2>📚 封面</h2>
<ul>
<li id="task-cover"><input type="checkbox" id="cbx_10"><label for="cbx_10">是否实训报告封面🖼️ </label><!-- points:5 --></li>
<li id="task-department"><input type="checkbox" id="cbx_11"><label for="cbx_11">院（系）是否正确填写🏫 </label><!-- points:5 --></li>
<li id="task-class"><input type="checkbox" id="cbx_12"><label for="cbx_12">专业班级 是否正确填写 （教务系统里的班级名称）🎓 </label><!-- points:5 --></li>
<li id="task-underline-alignment"><input type="checkbox" id="cbx_13"><label for="cbx_13">下划线是否对齐，整体一致美观🧹 </label><!-- points:5 --></li>
<li id="task-date"><input type="checkbox" id="cbx_14"><label for="cbx_14">落款日期是否为最新版论文日期📅 </label><!-- points:5 --></li>
<li id="task-cover-header"><input type="checkbox" id="cbx_15"><label for="cbx_15">封面没有页眉页码❌ </label><!-- points:5 --></li>
</ul>
<hr>
<h2>✍️中文摘要</h2>
<ul>
<li id="task-chinese-abstract-content">
<p><input type="checkbox" id="cbx_16"><label for="cbx_16">内容：三段式📝 </label><!-- points:10 --></p>
<p>（1）为什么做这个课题，是课题背景意义的浓缩；</p>
<p>（2）本课题采用什么技术做了哪些工作；</p>
<p>（3）做的效果如何，取得了什么成果。</p>
</li>
<li id="task-chinese-abstract-header">
<p><input type="checkbox" id="cbx_17"><label for="cbx_17">是否有页眉设置🖋️ </label><!-- points:5 --></p>
</li>
<li id="task-chinese-abstract-pagenum">
<p><input type="checkbox" id="cbx_18"><label for="cbx_18">是否有页码设置，且是罗马数字🔢 </label><!-- points:5 --></p>
</li>
<li id="task-chinese-abstract-wordcount">
<p><input type="checkbox" id="cbx_19"><label for="cbx_19">字数是否超过300字🔠 </label><!-- points:5 --></p>
</li>
<li id="task-chinese-abstract-keywords">
<p><input type="checkbox" id="cbx_20"><label for="cbx_20">关键词，3-5个，从左到右，语义范围越来越小🧐 </label><!-- points:5 --></p>
</li>
<li id="task-chinese-abstract-format">
<p><input type="checkbox" id="cbx_21"><label for="cbx_21">字体和段落格式是否符合要求，是否都使用中文标点符号🖍️ </label><!-- points:5 --></p>
</li>
</ul>
<hr>
<h2>🌎英文摘要</h2>
<ul>
<li id="task-english-abstract-alignment"><input type="checkbox" id="cbx_22"><label for="cbx_22">是否为两端对齐📏 </label><!-- points:5 --></li>
<li id="task-english-abstract-header"><input type="checkbox" id="cbx_23"><label for="cbx_23">页眉页码是否正确设置📝 </label><!-- points:5 --></li>
<li id="task-english-abstract-punctuation"><input type="checkbox" id="cbx_24"><label for="cbx_24">是否都使用了英文标点符号🔤 </label><!-- points:5 --></li>
</ul>
<hr>
<h2>📑目录</h2>
<ul>
<li id="task-toc-include-abstract"><input type="checkbox" id="cbx_25"><label for="cbx_25">是否包括中英文摘要🎯 </label><!-- points:5 --></li>
<li id="task-toc-subtitles"><input type="checkbox" id="cbx_26"><label for="cbx_26">是否只有一个小标题（一个二级目录下，不允许只有一个三级标题，如果有三级标题，那么就应该有两个及以上）📚 </label><!-- points:5 --></li>
<li id="task-toc-header"><input type="checkbox" id="cbx_27"><label for="cbx_27">页眉是否正确设置🖋️ </label><!-- points:5 --></li>
<li id="task-toc-pagenum"><input type="checkbox" id="cbx_28"><label for="cbx_28">页码是否正确设置，从中文到目录为止，是否都为罗马数字且连续。🔢 </label><!-- points:5 --></li>
<li id="task-toc-structure"><input type="checkbox" id="cbx_29"><label for="cbx_29">整体的目录结构是否符合标准（6个大章节） 🛠️ </label><!-- points:5 --></li>
<li id="task-toc-format"><input type="checkbox" id="cbx_30"><label for="cbx_30">字体和段落格式是否正确。📖 </label><!-- points:5 --></li>
<li id="task-toc-introduction"><input type="checkbox" id="cbx_31"><label for="cbx_31">绪论部分中</label><strong>是否有“课题主要内容” 小节</strong>📖 <!-- points:5 --></li>
<li id="task-toc-requirements"><input type="checkbox" id="cbx_32"><label for="cbx_32"></label><strong>是否有“需求设计” 章节</strong>🖥️ <!-- points:5 --></li>
<li id="task-toc-system-design"><input type="checkbox" id="cbx_33"><label for="cbx_33"></label><strong>是否有“系统设计与实现”章节</strong>⚙️ <!-- points:5 --></li>
<li id="task-toc-system-testing"><input type="checkbox" id="cbx_34"><label for="cbx_34"></label><strong>是否有“系统测试”章节</strong>🧪 <!-- points:5 --></li>
<li id="task-toc-summary"><input type="checkbox" id="cbx_35"><label for="cbx_35"></label><strong>是否有“总结” 章节，且有两个小节（总结与展望</strong> 🔮 <!-- points:5 --></li>
</ul>
<hr>
<h2>📖正文</h2>
<h3>正文内容格式</h3>
<table>
<thead>
<tr>
<th style="text-align:left">理工类：</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>1××××</strong>（三号黑体，居中）</td>
</tr>
<tr>
<td style="text-align:left">×××× (内容用小四号宋体)</td>
</tr>
<tr>
<td style="text-align:left"><strong>1.1××××</strong>（小三号黑体，居左）</td>
</tr>
<tr>
<td style="text-align:left">××××（内容用小四号宋体）</td>
</tr>
<tr>
<td style="text-align:left"><strong>1.1.1××××</strong>（四号黑体，居左，右缩进两个字）</td>
</tr>
<tr>
<td style="text-align:left">××××（内容用小四号宋体）</td>
</tr>
<tr>
<td style="text-align:left">①××××（用与内容同样大小的宋体，右缩进两个字）</td>
</tr>
<tr>
<td style="text-align:left">1）××××（用与内容同样大小的宋体，右缩进两个字）</td>
</tr>
<tr>
<td style="text-align:left">a．××××（用与内容同样大小的宋体）</td>
</tr>
</tbody>
</table>
<ul>
<li id="task-body-header">
<p><input type="checkbox" id="cbx_36"><label for="cbx_36">页眉是否正确设置。基本都是奇偶页页眉。 📝 </label><!-- points:5 --></p>
</li>
<li id="task-body-pagenum">
<p><input type="checkbox" id="cbx_37"><label for="cbx_37">页码是否正确设置，从阿拉伯数字开始。🔢 </label><!-- points:5 --></p>
</li>
<li>
<p><input type="checkbox" id="cbx_38"><label for="cbx_38">二级标题和三级标题之间有一段引言描述。📋 如：</label></p>
<p>2.2系统需求</p>
<p>文字描述，文字描述</p>
<p>2.2.1硬件需求</p>
<p>文字描述，文字描述</p>
</li>
<li id="task-citations">
<p><input type="checkbox" id="cbx_39"><label for="cbx_39">是否正确引用了。 </label><!-- points:10 --></p>
<ul>
<li id="task-citation-order">引用顺序是否正常🔄 <!-- points:5 --></li>
<li id="task-citation-position">引用是否都在句号前面。🛑 <!-- points:5 --></li>
<li id="task-citation-location"><strong>是否都在该引用的地方引用了（xxx等<sup>[2]</sup>提出），不允许连续几个大段都在最后一话上引用</strong> 📚 <!-- points:5 --></li>
</ul>
</li>
<li>
<p><input type="checkbox" id="cbx_40"><label for="cbx_40">序号是否正确使用。如：（图为正确使用）</label></p>
<p>（缩进2字符）XXXXXX（正文）</p>
<p>（缩进2字符）①XXXXXXXX</p>
<p>（缩进2字符）XXXXXXXXX（正文）</p>
<p><img src="./selfcheck.assets/image-20250106102226983.png" alt="image-20250106102226983"></p>
</li>
<li id="task-indent">
<p><input type="checkbox" id="cbx_41"><label for="cbx_41">除一二级标题外，</label><strong>所有部分只首行缩进两个字符</strong> <!-- points:5 --></p>
</li>
<li id="task-orphan-lines">
<p><input type="checkbox" id="cbx_42"><label for="cbx_42"></label><strong>不允许出现孤行。（页面最后一行是二级或三级标题，称为孤行）</strong>⚠️ <!-- points:5 --></p>
</li>
<li id="task-final-summary">
<p><input type="checkbox" id="cbx_43"><label for="cbx_43">最后总结部分，</label><strong>必须包括论文总结、研究与展望两部分</strong> <!-- points:10 --></p>
<ul>
<li id="task-summary">论文总结：描述本文采用什么技术主要完成了哪些工作 🏆 <!-- points:5 --></li>
<li id="task-future-work">研究与展望：描述针对课题哪些功能还有待优化，下一步工作的努力方向。🌟 <!-- points:5 --></li>
</ul>
</li>
</ul>
<hr>
<h3>📊 表格</h3>
<ul>
<li id="task-table-font"><input type="checkbox" id="cbx_44"><label for="cbx_44">表序、表题和表格内字体均为五号宋体✏️ </label><!-- points:5 --></li>
<li id="task-table-position"><input type="checkbox" id="cbx_45"><label for="cbx_45">表序和表题置于表格上方中间位置🗂️ </label><!-- points:5 --></li>
<li id="task-table-sequence"><input type="checkbox" id="cbx_46"><label for="cbx_46">应逐章单独编序，表序必须连续，不得重复或跳跃 </label><!-- points:5 --></li>
<li id="task-table-center"><input type="checkbox" id="cbx_47"><label for="cbx_47">表是否居中📖 </label><!-- points:5 --></li>
<li id="task-table-referenced"><input type="checkbox" id="cbx_48"><label for="cbx_48">是否在表的上下文中有提及该表。比如：在这个表的前面正文中有提及“如表 X.X 所示” </label><!-- points:5 --></li>
<li id="task-table-no-image"><input type="checkbox" id="cbx_49"><label for="cbx_49">没有图代替表🚫 </label><!-- points:5 --></li>
</ul>
<hr>
<h3>🖼️图</h3>
<ul>
<li id="task-figure-position"><input type="checkbox" id="cbx_50"><label for="cbx_50">图序和图题置于图下方中间位置🖋️ </label><!-- points:5 --></li>
<li id="task-figure-font"><input type="checkbox" id="cbx_51"><label for="cbx_51">图序、图题和图内字体均为五号宋体✍️ </label><!-- points:5 --></li>
<li id="task-figure-sequence"><input type="checkbox" id="cbx_52"><label for="cbx_52">图序逐章单独编序，图序必须连续，不得重复或跳跃🔄 </label><!-- points:5 --></li>
<li id="task-figure-center"><input type="checkbox" id="cbx_53"><label for="cbx_53">图是否居中📐 </label><!-- points:5 --></li>
<li id="task-figure-referenced"><input type="checkbox" id="cbx_54"><label for="cbx_54">是否在图的上下文中有提及该图。比如：在这个图的前面正文中有提及“如图 X.X 所示”🖼️ </label><!-- points:5 --></li>
</ul>
<hr>
<h2>📖参考文献</h2>
<ul>
<li id="task-references-format"><input type="checkbox" id="cbx_55"><label for="cbx_55">格式与百度学术或知网文献格式相同📚 </label><!-- points:5 --></li>
<li id="task-references-formatting"><input type="checkbox" id="cbx_56"><label for="cbx_56">字体、段落设置正确🖋️ </label><!-- points:5 --></li>
</ul>
<hr>
<h2>❤️致谢</h2>
<ul>
<li id="task-acknowledgements">
<p><input type="checkbox" id="cbx_57"><label for="cbx_57">致谢内容撰写： </label><!-- points:10 --></p>
<p>关于致谢，这不仅仅是课题实施环节的致谢，而是对大学生活的致谢，需要致谢所有帮组过你的人，包括父母家人，恋人，亲朋好友，学校师生，企业指导教师（他们是第一导师），以及企业培训老师，参考文献中的作者，还有其他你认为对你学习、生活帮组过的人。</p>
</li>
<li id="task-no-plagiarism">
<p><input type="checkbox" id="cbx_58"><label for="cbx_58"></label><strong>不要抄袭</strong> 🚫 <!-- points:5 --></p>
</li>
</ul>

  
  <div id="progress-bar">
    <div id="progress">0%</div>
  </div>
  
  <div id="level-display">
    <strong>当前等级：</strong><span id="current-level">1</span>
  </div>
  
  <button id="submit-button">提交自检结果</button>
  
  <!-- 模态窗口 -->
  <div id="survey-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <iframe src="https://wj.qq.com/s2/17487730/7be9/" frameborder="0"></iframe>
    </div>
  </div>
  
  <!-- 声音元素已移除 -->
  
  <script>
    // 检查浏览器是否支持Local Storage
    if (typeof(Storage) === 'undefined') {
      alert('抱歉，您的浏览器不支持Local Storage功能。无法保存您的进度。');
    }

    // 获取所有复选框
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const totalPointsEl = document.querySelector('#total-points');
    const badgesEl = document.querySelector('#badges');
    const progressEl = document.querySelector('#progress');
    const levelEl = document.querySelector('#current-level');
    const submitButton = document.querySelector('#submit-button');

    // 模态窗口元素
    const modal = document.getElementById("survey-modal");
    const span = document.getElementsByClassName("close")[0];

    // 积分和徽章数据
    const badges = {
      '炼气期': { required: 20 },  
      '筑基期': { required: 100 },  
      '结丹期': { required: 200 },  
      '元婴期': { required: 300 },  
      '化神期': { required: 355 },  
      '渡劫期': { required: 120 },  
      '大乘期': { required: 200 }, 
      '合道期': { required: 300 }, 
      '无上仙人': { required: 355 },  
      // 可以根据需要添加更多徽章
    };
    const levels = [
      { level: 1, required: 0 },
      { level: 2, required: 20 },
      { level: 3, required: 40 },
      { level: 4, required: 60 },
      { level: 5, required: 80 },
      { level: 6, required: 100 },
      { level: 7, required: 120 },
      { level: 8, required: 160 },
      { level: 9, required: 200 },
      { level: 10, required: 250 },
      { level: 11, required: 300 },
      { level: 12, required: 355 },
      // 根据需要添加更多等级
    ];
    let currentLevel = 1;
    let totalPoints = 0;
    let unlockedBadges = [];

    // 初始化：加载数据
    window.onload = () => {
      // 设置 data-points 属性
      checkboxes.forEach(cb => {
        const pointsMatch = cb.parentElement.innerHTML.match(/<!--\s*points:(\d+)\s*-->/);
        if (pointsMatch) {
          cb.setAttribute('data-points', pointsMatch[1]);
        } else {
          cb.setAttribute('data-points', '0'); // 如果未指定积分，默认为0
        }
      });

      // // 加载总积分
      // if (localStorage.getItem('totalPoints')) {
      //   totalPoints = parseInt(localStorage.getItem('totalPoints'));
      //   if (!isNaN(totalPoints)) {
      //     totalPointsEl.textContent = totalPoints;
      //   } else {
      //     totalPoints = 0;
      //     totalPointsEl.textContent = totalPoints;
      //   }
      // }

      totalPoints = 0;
      totalPointsEl.textContent = totalPoints;

      // 加载已解锁的徽章
      if (localStorage.getItem('unlockedBadges')) {
        unlockedBadges = JSON.parse(localStorage.getItem('unlockedBadges'));
        updateBadges();
      }

      // 加载当前等级
      if (localStorage.getItem('currentLevel')) {
        currentLevel = parseInt(localStorage.getItem('currentLevel'));
        if (!isNaN(currentLevel)) {
          levelEl.textContent = currentLevel;
        } else {
          currentLevel = 1;
          levelEl.textContent = currentLevel;
        }
      }

      // 初始化复选框状态
      checkboxes.forEach(cb => {
        const taskId = cb.parentElement.getAttribute('id');
        if (localStorage.getItem(taskId) === 'true') {
          cb.checked = true;
          const points = parseInt(cb.getAttribute('data-points'));
          if (!isNaN(points)) {
            addPoints(points);
          }
          markCompleted(cb);
        }
        // 添加事件监听
        cb.addEventListener('change', () => {
          const points = parseInt(cb.getAttribute('data-points'));
          if (cb.checked) {
            if (!isNaN(points)) {
              addPoints(points);
            }
            markCompleted(cb);
            localStorage.setItem(taskId, 'true');
            checkBadges();
            checkLevels();
          } else {
            if (!isNaN(points)) {
              subtractPoints(points);
            }
            unmarkCompleted(cb);
            localStorage.setItem(taskId, 'false');
            checkBadges();
            checkLevels();
          }
          saveData();
          updateProgress();
        });
      });

      // 在页面加载时检查徽章和等级
      checkBadges();
      checkLevels();
      updateProgress();
    };

    function addPoints(points) {
      totalPoints += points;
      updatePoints();
    }

    function subtractPoints(points) {
      totalPoints -= points;
      if (totalPoints < 0) totalPoints = 0;
      updatePoints();
    }

    function updatePoints() {
      totalPointsEl.textContent = totalPoints;
    }

    function markCompleted(checkbox) {
      checkbox.parentElement.classList.add('completed');
    }

    function unmarkCompleted(checkbox) {
      checkbox.parentElement.classList.remove('completed');
    }

    function checkBadges() {
      let newBadges = [];
      for (const badge in badges) {
        if (totalPoints >= badges[badge].required && !unlockedBadges.includes(badge)) {
          newBadges.push(badge);
        }
      }

      if (newBadges.length > 0) {
        unlockedBadges = unlockedBadges.concat(newBadges);
        updateBadges();
        newBadges.forEach(badge => unlockBadge(badge));
        saveData(); // 保存已解锁的徽章
      }
    }

    function updateBadges() {
      if (unlockedBadges.length === 0) {
        badgesEl.textContent = '无';
      } else {
        badgesEl.innerHTML = unlockedBadges.map(b => `<span>${b}</span>`).join('');
      }
    }

    function unlockBadge(badge) {
      // 显示徽章解锁弹窗
      Swal.fire({
        title: '恭喜！',
        text: `您已解锁徽章：${badge}`,
        icon: 'success',
        confirmButtonText: '继续加油！'
      });

      // 触发庆祝动画
      confetti({
        particleCount: 200,
        spread: 70,
        origin: { y: 0.6 }
      });

      // 触发徽章解锁动画
      const badgeElements = document.querySelectorAll('#badges span');
      badgeElements.forEach(span => {
        if (span.textContent === badge) {
          span.classList.add('unlocked');
          setTimeout(() => {
            span.classList.remove('unlocked');
          }, 1000);
        }
      });
    }

    function checkLevels() {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (totalPoints >= levels[i].required) {
          if (currentLevel < levels[i].level) {
            currentLevel = levels[i].level;
            updateLevel();
            unlockLevel(currentLevel);
          }
          break;
        }
      }
      saveData(); // 保存当前等级
    }

    function updateLevel() {
      levelEl.textContent = currentLevel;
    }


    function saveData() {
      localStorage.setItem('totalPoints', totalPoints);
      localStorage.setItem('unlockedBadges', JSON.stringify(unlockedBadges));
      localStorage.setItem('currentLevel', currentLevel);
    }

    function updateProgress() {
      const totalTasks = checkboxes.length;
      const completedTasks = document.querySelectorAll('input[type="checkbox"]:checked').length;
      const progressPercent = Math.round((completedTasks / totalTasks) * 100);
      progressEl.style.width = `${progressPercent}%`;
      progressEl.textContent = `${progressPercent}%`;

      // 更改进度条颜色
      if (progressPercent < 50) {
        progressEl.classList.remove('medium', 'high');
        progressEl.classList.add('low');
      } else if (progressPercent < 100) {
        progressEl.classList.remove('low', 'high');
        progressEl.classList.add('medium');
      } else {
        progressEl.classList.remove('low', 'medium');
        progressEl.classList.add('high');
      }
    }

    // 提交按钮功能
    submitButton.addEventListener('click', () => {
      // 检查是否所有任务都已完成
      const allCompleted = Array.from(checkboxes).every(cb => cb.checked);
      if (!allCompleted) {
        Swal.fire({
          title: '尚未完成所有任务',
          text: '请完成所有自检任务后再提交。',
          icon: 'warning',
          confirmButtonText: '继续自检'
        });
        return;
      }

      // 直接显示模态窗口，嵌入腾讯问卷
      modal.style.display = "block";
    });

    // 当用户点击 <span> (x)，关闭模态窗口
    span.onclick = function() {
      modal.style.display = "none";
    }

    // 当用户在模态窗口外点击，关闭模态窗口
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>
